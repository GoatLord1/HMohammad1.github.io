<!DOCTYPE html>
<html>
<head>

<meta charset="utf-8">
<title>asdf</title>

<style type="text/css">

* {
	padding: 0;
	margin: 0;
}

body {
	font-family: monospace;
}

div.content-container {
	max-width: 800px;

	margin: 20px auto 0 auto;
}

p, pre {
	margin: 0.5em;
}

button {
	font: inherit;

	padding: 0.25em 0.4em;
	margin: 0 0.5em;

	border: 2px solid #0007;

	background-color: #0001;
}

button#start-stop::after {
	content: "Start Server";
}
button#start-stop.running::after {
	content: "Stop Server";
}

</style>

<script type="text/javascript">

const updateInterval = 2000; // ms

var running;

const req = (url, callback) => {
	fetch(url).then((res)=>res.json()).then((data)=>{callback(data)});
};

function updateServerStatus() {
	req("/admin/api/serverrunning", (data) => {
		running = data.running;

		let statusElem = document.getElementById('status');
		statusElem.innerText = "Server " + (running ? "running" : "not running");

		let startStopButton = document.getElementById('start-stop');
		if (running)
			startStopButton.classList.add('running');
		else
			startStopButton.classList.remove('running');
	});
}

function startStopServer() {
	req(running ? "/admin/api/serverstop" : "/admin/api/serverstart", (data) => {
		updateServerStatus();
		if (data && data.msg) console.log(data.msg);
	});
}

function restartServer() {
	req("/admin/api/serverrestart", (data) => {
		console.log(data);
	});	
}

function gitPull() {
	req("/admin/api/gitpull", (data) => {
		prt(data.msg);
	});
}

function gitStatus() {
	req("/admin/api/gitpull", (data) => {
		prt(data.msg);
	});
}

function prt(msg) {
	let elem = document.getElementById('git-status');

	elem.innerText = msg;
}

document.addEventListener('DOMContentLoaded', () => {
	// Initial update
	updateServerStatus();

	// Regularly update the page
	setInterval(updateServerStatus, updateInterval);
});

</script>

</head>
<body>

<div class="content-container">
<p id="status">(Server status)</p>
<button id="start-stop" onclick="startStopServer()"></button>
<button id="restart" onclick="restartServer()">Restart Server</button>
<!-- <br>
<button onclick="updateServerStatus()">Update Page</button> -->

<hr>

<button id="git-pull" onclick="gitPull()">Git Pull</button>
<button id="git-status" onclick="gitStatus()">Git Status</button>

<pre id="git-status">(Git status)</pre>

</div>

</body>
</html>
